(()=>{"use strict";"serviceWorker"in navigator&&window.addEventListener("load",(async()=>{console.log("======================================================="),console.log("SW registration and subscription to push notifications."),console.log("=======================================================");try{const e=await navigator.serviceWorker.register("/service-worker.js");console.log("1/3 SW registered: ",e);const t=await function(e){return e.pushManager.getSubscription().then((async t=>{if(t)return t;const o=await fetch("/vapidPublicKey"),n=function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(t),n=new Uint8Array(o.length);for(let e=0;e<o.length;e+=1)n[e]=o.charCodeAt(e);return n}(await o.text());return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})}))}(e);console.log("2/3 SW subscription: ",t),await async function(e){const t=JSON.stringify({subscription:e}),o=await fetch("/subscribe",{method:"post",headers:{"Content-type":"application/json"},body:t}),n=await o.text();console.log("serverSubscription:",n)}(t),console.log("3/3 SW subscribed")}catch(e){console.log("SW registration or subscription failed: ",e)}console.log("=======================================================")}))})();